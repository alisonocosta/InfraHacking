Enumeration (Post-Exploitation)
========================



## Windows

1) Navegar nos diretorios do usuario para ver se existe algo ali que possa nos fornecer uma credencial ou algum bionario que inicie um servico/programa vulneravel a escalacao de privilegio
2) checar credenciais no registro do windows
3) checar programas instalados na maquina por meio do program files ou program files (x86)
4) checar os servicos que estao rodando na maquina para ver se temos permissao de alteracao em algum deles
5) checar as scheduleds tasks
6) verificar se existe algum servico rodando em localhost para exploracao de escalacao de privilegio
7) em sistemas mais antigos, explorar vulnerabilidades de kernel
8) Ja peguei cenarios em que uma maquina virtual estava instalada na maquina e foi possivel obter credenciais no historico desta mesma maquina
9) Rodar o powerUp para verificar se existe algum servico disponivel para exploracao com permissoes demais. Aqui temos que usar o accesschk
10)  Testes mais basicos como testar a propria credencial do suuario ja comprometido para o Administrator tambem pode
Primeiro passo a ser considerado para escalação de privilégio é obter o máximo de informação possível a respeito do alvo:

### Usuário ao qual estamos acessando a maquina

    whoami /all
    net user username

### Demais usuarios da maquina

    net user
    
### Hostname

    hostname

### Informações a respeito do sistema

    systeminfo
ou
  
    systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"

    #Obter hotfixes
    wmic qfe
    
    #Obter informações a respeito dos discos associadas ao host
    wmic logicaldisk get caption

### Enumeração de processos
    
    tasklist /svc
    tasklist
    
Started services

    net start


### Network information

A presença de interfaces virtuais pode aferir a ideia de existir máquinas virtuais na máquina ou de anti vírus instalado.

    ipconfig /all
    route print
    netstat -ano #(process ID como -o, requer privilégios administrativos)
    netstat -anb #(nome do binário com o -b, requer privilégios administrativos)
    
### firwewall rules enumeration

    netsh advfirewall show currentprofile
    
    netsh advfirewall firewall show rule name=all
    
### scheduled tasks

Procurar por atividades que serão executadas com privilégio elevado na máquina. Dessa formma, considerando que vamos procurar por arquivos que podemos acessar com um usuário comum para obter a escalação de privilégio.

    schtasks /query /fo LIST /v
    
### Patches and applications

    wmic product get name, version, vendor
    
    wmic qfe get Caption, Description, HotFixID, InstalledOn

### Enumerate writable/readable

    accesschk.exe -uws "Everyone" "C:\Program Files"
    
    Get-ChildItem "C:\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}
    
### Enumerate unmounted disks

    mountvol
    
    
### Enumerate SUID files/ files auto elevate

    reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
    
    reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer





## Linux

### Usuário ao qual estamos acessando a maquina

    id

### Demais usuários na máquina

    cat /etc/passwd

non-system users:

    awk -F: '($3>=1000)&&($1!="nobody"){print $1}' /etc/passwd

### Hostname

    hostname
    
### Informações a respeito do sistema

    cat /etc/issue
    
    cat /etc/*-release
    
    uname -a
  
    cat /proc/version
  
### Enumeração de processos

    ps axu
    
### Network information

    ip a
    ifconfig
    route
    routel
    ip route
    
    netstat -napl
    netstat -naptl
    
    ss -anp

### firwewall rules enumeration

Para fazer enumeração do iptables, é necessário ser root na máquina, porém existe a possibilildade de acharmos um arquivo por meio do comando iptables-save com o comando history e tentar achá-lo no disco (geralmente em /etc).

Além disso temos a opção de procurar o arquivo que fica salvo no diretório /etc/iptables por padrão.

### scheduled tasks

    ls -lah /etc/cron* 
    
   
    cat /etc/crontab

### Patches and applications

    dpkg -l

### Enumerate writable/readable

    find / -writable -type d 2>/dev/null
    
    
### Enumerate unmounted disks

    cat /etc/fstab 
    mount
    /bin/lsblk


### Enumerate SUID files/ files auto elevate

Com isso podemos executar o arquivo (caso seja um executável) conforme a permissão do dono do arquivo. Ou seja, se o dono do arquivo for root e o SUID bit estiver definido para o binário, podemos realizar a escalação de privilégio.

    find / -perm -u=s -type f 2>/dev/null
    
    
    
    find / -name local.txt 2>/dev/null
