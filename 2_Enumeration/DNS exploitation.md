DNS exploitation
========================
# Enumerate domain

Primeiro temos que verificar se a gente consegue obter o nome do domínio por mieo de uma resolução invesrsa de DNS da seguinte maneira:
Informar o serviço de DNS encontrado por meio do comando abaixo:
    
    sudo nmap -sU -p 53 192.168.134.0/24 -oG dns_enum_lab.txt
    #Assim que achado o DNS server (porta 53 aberta), fazemos um nslookup ou host para um host da rede
    #host <IPS_DA_REDE> <IP_DNS_SERVER>
    host 192.168.134.149 192.168.134.149
    

    nslookup
    server 192.168.134.149    
![qownnotes-media-GwrWbS](../../media/qownnotes-media-GwrWbS.png)

    host -t ns mailman.com # Para encontrar o name server do domínio


# Enumerating subdomains


Brute-force: 

	dnsrecon -d target.com -D wordlist.txt -t brt
	
**OBS: wordlist can be found at:**

**C:\Users\olive\Desktop\acosta\owncloud\Tools_Utilities\hacking-tools\fuzzdb\discovery\dns**


## DNS cache snooping: 
	
	dnsrecon -t snoop -D wordlist.txt -n 2.2.2.2 where 2.2.2.2 is the IP of the target’s NS server
Options
--threads 8: Number of threads
-n nsserver.com: Use a custom name server
Output options
--db: SQLite 3 file
--xml: XML file
--json: JSON file
--csv: CSV file

## DNS Zone transfer

	dnsrecon -d target.com -t axfr
	
or
	
	host -l target.com <dns_server_address>
	
**OBS: First find which dns servers correspond to that domain with:**
	
	host -t ns target.com
	
![qownnotes-media-XJyjiZ](file://media/18886.png)

DNS Query types:

https://ns1.com/resources/dns-types-records-servers-and-queries

## sublim3r (Subdomains enumerator)



# Enumeração de DNS (domínio)

Preimeiro temos que identificar qual o servidor de DNS que responde por este serviço:

    nmap -p 53 -sU --open 10.11.1.0/24 -oG dns_servers.txt
    
Assim que obtido o servidor, ou seja, obter a resposta do comando acima para os IPs que responderam com "open", configuramos ele no arquivo /etc/resolv.conf ccom a seguinte diretiva:

    nameserver <IP_SERVER_DNS>

Feito isso, executamos o seguinte comando para obter o nome de domínio da rede alvo:

    fping -d -a -g 10.0.0.0/24 # -> reverse DNS lookup   
    #ou
    fping -d -A -a -g 10.0.0.0/24 #(para obter o endereço de IP ao lado do hostname)
    
![qownnotes-media-RkNxKi](../media/qownnotes-media-RkNxKi.png)


Depois, tentamos realizar uma transferência de zona para obter informações a respeito do domínio:

    host -t axfr thinc.local <IP_DNS_SERVER>
    #ou
    dig axfr thinc.local @<IP_DNS_SERVER> #Esse não funionou e não entendi o porquê
    #ou
    dnsenum thinc.local # pode ser informado a flag --dnsserver <IP_DNS_SERVER> para especificar o server de DNS
    
![qownnotes-media-TnBCdx](../media/qownnotes-media-TnBCdx.png)


Dessa forma obtemos todas as informações a respeito daquele domínio. ALém disto, observamos um subdomínio especial ali e tentamos uma transferência de zona lá também, sem sucesso, mas anda temos mais uma possibilidade que é enumerar os subdomínios da seguinte forma:

    dnsrecon -d _msdcs.thinc.local -D /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -t brt 
    
